# 13 ICMP

<!-- !!! tip "说明"

    本文档正在更新中…… -->

!!! info "说明"

    本文档仅涉及部分内容，仅可用于复习重点知识

## 13.1 ICMP 消息

### 13.1.1 ICMPv4 and ICMPv6 消息

Internet 控制消息协议 (ICMP) 

ICMP 可同时用于 IPv4 和 IPv6。ICMPv4 是 IPv4 的消息协议。ICMPv6 为 IPv6 提供相同的服务，此外，还包括其他功能

ICMP 消息的类型及其发送原因非常多。ICMPv4 和 ICMPv6 通用的 ICMP 消息包括：

1. 主机联通性
2. 目的地或服务不可达
3. 超时

### 13.1.5 ICMPv6 消息

ICMPv6 在邻居发现协议（ND 或 NDP）中包括四个新协议

IPv6 路由器和 IPv6 设备之间的消息传递，包括动态地址分配如下所示：

1. 路由器请求 (RS) 消息
2. 路由器通告 (RA) 消息

IPv6 设备之间的消息传递，包括重复的地址检测和地址解析如下所示：

1. 邻居请求 (NS) 消息
2. 邻居通告 (NA) 消息

## 13.2 Ping 和 Traceroute 测试

### 13.2.1 Ping-测试连接性

为了测试与网络上的另一台主机的连接，可使用 ping 命令将回应请求发送给该主机地址。若指定地址处的主机收到回应请求，便会使用 Echo 应答进行响应。每收到一个 Echo 应答，ping 都会提供发出请求与收到应答的时间反馈。这可以作为网络性能的度量

使用 ping 进行的连通性测试的类型包括:

1. Ping 本地环回
2. 向默认网关发出 ping 命令
3. Ping 远程主机

### 13.2.2 对环回执行 ping 命令

Ping 可用于测试本地主机上 IPv4 或 IPv6 的内部配置。要执行此测试，对于 IPv4，我们 ping 本地环回地址 127.0.0.1，对于 IPv6，则是 ::1

### 13.2.3 向默认网关发出 ping 命令

您也可以使用 ping 测试主机在本地网络中通信的能力。这通常是通过 ping 主机网关 IP 地址完成的。成功 ping 通网关表示主机和充当网关的路由器接口在本地网络中均运行正常

### 13.2.4 Ping 远程主机

Ping 也可用于测试本地主机跨互联网通信的能力。如果 ping 成功，则说明网际网络大部分运行正常

### 13.2.5 Traceroute - 测试路径

Traceroute tracert 实用程序可以生成通信路径上成功到达的设备列表。此列表可以提供重要的验证和故障排除信息。如果数据到达目的地，则 Trace 就会列出主机之间的路径中每台路由器上的接口。如果数据在沿途的某一跳上失败，则回应 Trace 的最后一个路由器的地址可以提供指示，说明发现问题或有安全限制的地方