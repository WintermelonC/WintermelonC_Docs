# 12 Mass storage Systems

!!! tip "说明"

    本文档正在更新中……

!!! info "说明"

    本文档仅涉及部分内容，仅可用于复习重点知识

## 1 Overview of Mass Storage Structure

硬盘作为二级存储（外存）的主要介质，用于长期、大容量数据存储

性能关键参数：

1. 转速：直接影响读写速度，单位通常是 RPM（每分钟转数）
2. transfer rate（传输速率）：衡量数据在硬盘与内存 / CPU 之间传输的速度
3. positioning time / random access time（定位时间）：seek time（寻道时间，磁头移动到目标磁道的时间） + rotational latency（旋转延迟，盘片旋转至目标扇区到达磁头下方的时间）

head crash（磁头碰撞）：磁头与高速旋转的盘片接触会导致物理损坏和数据丢失，是硬盘的严重故障

硬盘通过多种 I/O 总线与计算机连接，常见的接口包括 SATA、SCSI、USB 等。主机控制器（在主板上）与磁盘控制器（在硬盘内部）协同工作，负责数据传输与控制指令

<figure markdown="span">
    ![Img 1](../../../../img/operating_system/ch12/os_ch12_img1.png){ width="600" }
</figure>

<figure markdown="span">
    ![Img 2_1](../../../../img/computer_organization/theory/ch6/comp_ch6_img2.png){ width="600" }
</figure>

!!! tip "Nonvolatile Memory Devices"

    固态硬盘（SSD）使用 NAND 闪存（属于非易失性存储器）作为存储单元，断电后数据不会丢失

    NAND 闪存不能直接覆盖已写入的数据。要更新数据，必须先将整个存储块（Block）擦除，然后再写入新数据。读取操作最快，写入操作次之，擦除最慢。这种特性被称为写入放大和擦除延迟

    每个 NAND 存储单元有一定的编程-擦除循环次数上限。超过此限制后，单元可能失效，因此 SSD 需要通过磨损均衡等技术来延长整体寿命

magnetic tape（磁带）：磁带是计算机早期常用的二级存储介质，至今仍因其大容量、低成本、数据持久的特性而在特定领域中使用

特点：

1. 访问速度极慢：由于是顺序访问介质，随机访问性能远低于磁盘
2. 传输速率尚可：一旦定位到目标位置，连续读写的传输速率可与磁盘媲美

主要用途：

1. 数据备份与归档：适用于不常访问但需长期保存的数据（如历史记录、法律文档、冷备份）
2. 系统间数据迁移：因磁带便于物理携带，曾常用于大规模数据转移

磁带缠绕在带盘中，通过机械传动经过磁头进行读写。典型容量在 20-200 GB 范围

## 2 Disk Structure

操作系统将磁盘看作一个连续的一维逻辑块数组，每个逻辑块是磁盘 I/O 操作的最小单位。这样抽象后，上层系统无需关心磁盘的物理结构，只需通过逻辑块号（LBA，logical block addressing）进行读写

逻辑块到物理扇区的映射是顺序且连续的，从最外圈柱面的第一个磁道的第一个扇区开始编号为逻辑块 0。映射顺序为：先填满当前磁道的所有扇区，然后移到同一柱面的下一个磁头（对应不同盘面的同一半径位置），当前柱面所有磁道用完后，再移到下一个柱面（从外向内依次进行）

这种映射方式使得外圈磁道的扇区密度较低但线速度较快，因此外圈区域的理论传输速率通常高于内圈。顺序访问时（尤其是从外圈开始）性能较好，因为减少了磁头移动和寻道时间

## 3 Disk Attachment

<figure markdown="span">
    ![Img 2](../../../../img/operating_system/ch12/os_ch12_img2.png){ width="600" }
</figure>

host-attached storage（主机连接存储）：存储设备直接通过 I/O 总线（如 SCSI、SATA 等）连接到单个主机。性能较高，但扩展性受限，通常用于服务器或高性能工作站

Small Computer System Interface（SCSI）是一种并行总线标准，一条总线最多支持 16 个设备。SCSI 启动器通常为主机适配卡，发出 I/O 请求。SCSI 目标器为存储设备控制器，执行具体操作。每个目标器可管理多个逻辑单元（如磁盘、磁带机），支持更灵活的存储配置

fibre channel（光纤通道）：高速串行传输技术，常用于高性能存储网络

1. 支持交换式网络（Switched Fabric）：通过交换机连接，形成存储区域网络（SAN），具有高可扩展性和灵活性。提供 24 位地址空间，支持大量设备互联
2. 也支持仲裁环（FC-AL）：设备以环形拓扑连接，最多 126 个节点，结构简单但扩展性较低

<figure markdown="span">
    ![Img 3](../../../../img/operating_system/ch12/os_ch12_img3.png){ width="600" }
</figure>

## 4 Disk Scheduling

## 5 Disk Management

## 6 Swap Space Management

## 7 RAID Structure

## 8 Disk Attachment

## 9 Stable Storage Implementation