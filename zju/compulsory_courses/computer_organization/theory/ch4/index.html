
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="WinteremelonC 的网页">
      
      
        <meta name="author" content="WintermelonC">
      
      
        <link rel="canonical" href="https://wintermelonc.github.io/WintermelonC_Docs/zju/compulsory_courses/computer_organization/theory/ch4/">
      
      
        <link rel="prev" href="../ch3/">
      
      
        <link rel="next" href="../../lab/">
      
      
      <link rel="icon" href="../../../../../img/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.47">
    
    
      
        <title>4 The Processor - WintermelonC Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.06af60db.min.css">
      
      

  
  
  
  
  <style>:root{--md-annotation-icon:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 13h-4v4h-2v-4H7v-2h4V7h2v4h4m-5-9A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2"/></svg>');}</style>


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://unpkg.com/katex@0/dist/katex.min.css">
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#4-the-processor" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../../../.." title="WintermelonC Docs" class="md-header__button md-logo" aria-label="WintermelonC Docs" data-md-component="logo">
      
  <img src="../../../../../img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            WintermelonC Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              4 The Processor
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="切换至黑夜模式"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="切换至黑夜模式" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="切换至白天模式"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="切换至白天模式" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/WintermelonC/WintermelonC_Docs" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    WintermelonC_Docs
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../.." class="md-tabs__link">
        
  
    
  
  首页

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../../" class="md-tabs__link">
          
  
    
  
  ZJU

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../common_sense/" class="md-tabs__link">
          
  
    
  
  大学生生活常识

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../application/" class="md-tabs__link">
          
  
    
  
  软件

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="WintermelonC Docs" class="md-nav__button md-logo" aria-label="WintermelonC Docs" data-md-component="logo">
      
  <img src="../../../../../img/logo.png" alt="logo">

    </a>
    WintermelonC Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/WintermelonC/WintermelonC_Docs" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    WintermelonC_Docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    首页
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    ZJU
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            ZJU
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../political/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    思政类
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2" id="__nav_2_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            思政类
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../political/history_of_CPC/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    中国共产党历史
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../military_PE/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    军体类
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3" id="__nav_2_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            军体类
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../military_PE/radio_direction_finding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    无线电测向（初级）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../military_PE/badminton/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    羽毛球（初级）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../military_PE/military_theory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    军事理论
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../natural_science/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    自然科学通识类
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_4" id="__nav_2_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            自然科学通识类
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../natural_science/phy_2/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    大学物理（乙）Ⅱ
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_4_2" id="__nav_2_4_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_2">
            <span class="md-nav__icon md-icon"></span>
            大学物理（乙）Ⅱ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../natural_science/phy_2/phy_2_doc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    整理
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../natural_science/phy_exp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    大学物理实验
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../innovation_entrepreneurship/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    创新创业类
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_5" id="__nav_2_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            创新创业类
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../innovation_entrepreneurship/entrepreneurship/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    创业启程
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../general_courses/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    通识选修课程
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_6" id="__nav_2_6_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            通识选修课程
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../general_courses/tea_culture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    茶文化与茶健康
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../general_courses/economic_law/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    经济法理论与实务
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../general_courses/bio_evolution_and_design/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    生物进化与设计
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_6_4" id="__nav_2_6_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6_4">
            <span class="md-nav__icon md-icon"></span>
            生物进化与设计
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../general_courses/bio_evolution_and_design/doc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    整理
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../general_courses/digital_audio_video/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    数字音视频基础与制作
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../general_courses/life_science/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    生命科学导论
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../general_courses/life_science_exp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    生命科学导论实验
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../basic_courses/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    专业基础课程
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_7" id="__nav_2_7_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            专业基础课程
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../basic_courses/discrete_math/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    离散数学及其应用
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../basic_courses/digital_logic_design/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    数字逻辑设计
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_7_3" id="__nav_2_7_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7_3">
            <span class="md-nav__icon md-icon"></span>
            数字逻辑设计
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7_3_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../basic_courses/digital_logic_design/lab/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    实验部分
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_7_3_2" id="__nav_2_7_3_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_7_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7_3_2">
            <span class="md-nav__icon md-icon"></span>
            实验部分
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../basic_courses/digital_logic_design/lab/final/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    final
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../basic_courses/prob_theo_and_math_stat/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    概率论与数理统计
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_7_4" id="__nav_2_7_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7_4">
            <span class="md-nav__icon md-icon"></span>
            概率论与数理统计
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../basic_courses/prob_theo_and_math_stat/chapter_1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 概率论的基本概念
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../basic_courses/prob_theo_and_math_stat/chapter_2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2 随机变量及其概率分布
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../basic_courses/prob_theo_and_math_stat/chapter_3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3 多维随机变量及其分布
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../basic_courses/prob_theo_and_math_stat/chapter_4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4 随机变量的数字特征
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../basic_courses/prob_theo_and_math_stat/chapter_5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5 大数定律及中心极限定律
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../basic_courses/prob_theo_and_math_stat/chapter_6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6 统计量与抽样分布
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../basic_courses/prob_theo_and_math_stat/chapter_7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7 参数估计
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    专业必修课程
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_8" id="__nav_2_8_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            专业必修课程
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../ADS/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    高级数据结构与算法分析
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_8_2" id="__nav_2_8_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_8_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_8_2">
            <span class="md-nav__icon md-icon"></span>
            高级数据结构与算法分析
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ADS/ch1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 AVL Trees, Splay Trees and Amortized Analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ADS/ch2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2 Red-Black Trees and B+ Trees
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ADS/ch3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3 Inverted File Index
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ADS/ch4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4 Leftist Heaps and Skew Heaps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ADS/ch5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5 Binomial Queues
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ADS/ch6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6 Backtracking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ADS/ch7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7 Divide and Conquer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ADS/ch8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8 Dynamic Programming
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ADS/ch9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9 Greedy Algorithms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ADS/ch10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10 Intractability
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ADS/ch11/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    11 Approximation Algorithms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ADS/ch12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    12 Local Search
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8_3" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    计算机组成
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_8_3" id="__nav_2_8_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_8_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_8_3">
            <span class="md-nav__icon md-icon"></span>
            计算机组成
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2_8_3_2" id="__nav_2_8_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    理论部分
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_8_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_8_3_2">
            <span class="md-nav__icon md-icon"></span>
            理论部分
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 Computer Abstractions and Technology
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2 Instructions: Language of the Computer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3 Arithmetic for Computers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    4 The Processor
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    4 The Processor
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#41-引言" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 引言
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.1 引言">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#411-一个基本的-risc-v-实现" class="md-nav__link">
    <span class="md-ellipsis">
      4.1.1 一个基本的 RISC-V 实现
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#412-实现方式概述" class="md-nav__link">
    <span class="md-ellipsis">
      4.1.2 实现方式概述
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#42-逻辑设计惯例" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 逻辑设计惯例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.2 逻辑设计惯例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#421-时钟方法" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.1 时钟方法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#43-建立数据通路" class="md-nav__link">
    <span class="md-ellipsis">
      4.3 建立数据通路
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.3 建立数据通路">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#431-创建一个简单的数据通路" class="md-nav__link">
    <span class="md-ellipsis">
      4.3.1 创建一个简单的数据通路
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#44-一个简单的实现机制" class="md-nav__link">
    <span class="md-ellipsis">
      4.4 一个简单的实现机制
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.4 一个简单的实现机制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#441-alu-控制" class="md-nav__link">
    <span class="md-ellipsis">
      4.4.1 ALU 控制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#442-主控制单元的设计" class="md-nav__link">
    <span class="md-ellipsis">
      4.4.2 主控制单元的设计
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#443-数据通路的操作" class="md-nav__link">
    <span class="md-ellipsis">
      4.4.3 数据通路的操作
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#444-控制的结束" class="md-nav__link">
    <span class="md-ellipsis">
      4.4.4 控制的结束
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#445-为什么不使用单周期实现方式" class="md-nav__link">
    <span class="md-ellipsis">
      4.4.5 为什么不使用单周期实现方式
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#45-流水线概述" class="md-nav__link">
    <span class="md-ellipsis">
      4.5 流水线概述
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.5 流水线概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#451-面向流水线的指令集设计" class="md-nav__link">
    <span class="md-ellipsis">
      4.5.1 面向流水线的指令集设计
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#452-流水线冒险" class="md-nav__link">
    <span class="md-ellipsis">
      4.5.2 流水线冒险
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.5.2 流水线冒险">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#结构冒险" class="md-nav__link">
    <span class="md-ellipsis">
      结构冒险
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#数据冒险" class="md-nav__link">
    <span class="md-ellipsis">
      数据冒险
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#控制冒险" class="md-nav__link">
    <span class="md-ellipsis">
      控制冒险
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#46-流水线数据通路及其控制" class="md-nav__link">
    <span class="md-ellipsis">
      4.6 流水线数据通路及其控制
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.6 流水线数据通路及其控制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#461-图形化表示流水线" class="md-nav__link">
    <span class="md-ellipsis">
      4.6.1 图形化表示流水线
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#462-流水线控制" class="md-nav__link">
    <span class="md-ellipsis">
      4.6.2 流水线控制
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#47-数据冒险转发与阻塞" class="md-nav__link">
    <span class="md-ellipsis">
      4.7 数据冒险：转发与阻塞
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.7 数据冒险：转发与阻塞">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#471-数据冒险与阻塞" class="md-nav__link">
    <span class="md-ellipsis">
      4.7.1 数据冒险与阻塞
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#48-控制冒险" class="md-nav__link">
    <span class="md-ellipsis">
      4.8 控制冒险
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.8 控制冒险">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#481-假定分支不发生" class="md-nav__link">
    <span class="md-ellipsis">
      4.8.1 假定分支不发生
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#482-缩短分支的延迟" class="md-nav__link">
    <span class="md-ellipsis">
      4.8.2 缩短分支的延迟
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#483-动态分支预测" class="md-nav__link">
    <span class="md-ellipsis">
      4.8.3 动态分支预测
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#484-流水线小结" class="md-nav__link">
    <span class="md-ellipsis">
      4.8.4 流水线小结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#49-异常" class="md-nav__link">
    <span class="md-ellipsis">
      4.9 异常
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.9 异常">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#491-异常在-risc-v-体系结构中的处理" class="md-nav__link">
    <span class="md-ellipsis">
      4.9.1 异常在 RISC-V 体系结构中的处理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#492-在流水线中的异常" class="md-nav__link">
    <span class="md-ellipsis">
      4.9.2 在流水线中的异常
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8_3_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../lab/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    实验部分
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_8_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_8_3_3">
            <span class="md-nav__icon md-icon"></span>
            实验部分
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_9" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../practical_teaching/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    实践教学环节
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_9" id="__nav_2_9_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_9">
            <span class="md-nav__icon md-icon"></span>
            实践教学环节
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../practical_teaching/practical_course_1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    课程综合实践Ⅰ
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../common_sense/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    大学生生活常识
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            大学生生活常识
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../common_sense/hospital/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    医院看病流程
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../common_sense/medical_insurance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    医保
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../common_sense/transportation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    如何乘坐交通工具
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../common_sense/rent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    租房流程及注意事项
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../application/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    软件
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            软件
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../application/br/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Br
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Br
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../application/br/ch1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 首选项
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../application/br/ch2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2 基本操作
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../application/br/ch3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3 文件整理/归纳/筛选
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../application/lr/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Lr
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Lr
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../application/ps/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Ps
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Ps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../application/pr/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Pr
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Pr
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../application/pr/plugins/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    插件
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../application/ae/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Ae
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            Ae
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../application/ae/plugins/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    插件
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6_3" >
        
          
          <label class="md-nav__link" for="__nav_4_6_3" id="__nav_4_6_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    其他
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_3">
            <span class="md-nav__icon md-icon"></span>
            其他
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../application/ae/other/shadow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    物体阴影
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../application/au/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Au
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7">
            <span class="md-nav__icon md-icon"></span>
            Au
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../application/me/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Me
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_8">
            <span class="md-nav__icon md-icon"></span>
            Me
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_9" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../application/Vivado/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Vivado
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_9">
            <span class="md-nav__icon md-icon"></span>
            Vivado
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_10" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../application/vscode/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    VS Code
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_10">
            <span class="md-nav__icon md-icon"></span>
            VS Code
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#41-引言" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 引言
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.1 引言">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#411-一个基本的-risc-v-实现" class="md-nav__link">
    <span class="md-ellipsis">
      4.1.1 一个基本的 RISC-V 实现
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#412-实现方式概述" class="md-nav__link">
    <span class="md-ellipsis">
      4.1.2 实现方式概述
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#42-逻辑设计惯例" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 逻辑设计惯例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.2 逻辑设计惯例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#421-时钟方法" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.1 时钟方法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#43-建立数据通路" class="md-nav__link">
    <span class="md-ellipsis">
      4.3 建立数据通路
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.3 建立数据通路">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#431-创建一个简单的数据通路" class="md-nav__link">
    <span class="md-ellipsis">
      4.3.1 创建一个简单的数据通路
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#44-一个简单的实现机制" class="md-nav__link">
    <span class="md-ellipsis">
      4.4 一个简单的实现机制
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.4 一个简单的实现机制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#441-alu-控制" class="md-nav__link">
    <span class="md-ellipsis">
      4.4.1 ALU 控制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#442-主控制单元的设计" class="md-nav__link">
    <span class="md-ellipsis">
      4.4.2 主控制单元的设计
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#443-数据通路的操作" class="md-nav__link">
    <span class="md-ellipsis">
      4.4.3 数据通路的操作
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#444-控制的结束" class="md-nav__link">
    <span class="md-ellipsis">
      4.4.4 控制的结束
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#445-为什么不使用单周期实现方式" class="md-nav__link">
    <span class="md-ellipsis">
      4.4.5 为什么不使用单周期实现方式
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#45-流水线概述" class="md-nav__link">
    <span class="md-ellipsis">
      4.5 流水线概述
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.5 流水线概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#451-面向流水线的指令集设计" class="md-nav__link">
    <span class="md-ellipsis">
      4.5.1 面向流水线的指令集设计
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#452-流水线冒险" class="md-nav__link">
    <span class="md-ellipsis">
      4.5.2 流水线冒险
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.5.2 流水线冒险">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#结构冒险" class="md-nav__link">
    <span class="md-ellipsis">
      结构冒险
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#数据冒险" class="md-nav__link">
    <span class="md-ellipsis">
      数据冒险
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#控制冒险" class="md-nav__link">
    <span class="md-ellipsis">
      控制冒险
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#46-流水线数据通路及其控制" class="md-nav__link">
    <span class="md-ellipsis">
      4.6 流水线数据通路及其控制
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.6 流水线数据通路及其控制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#461-图形化表示流水线" class="md-nav__link">
    <span class="md-ellipsis">
      4.6.1 图形化表示流水线
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#462-流水线控制" class="md-nav__link">
    <span class="md-ellipsis">
      4.6.2 流水线控制
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#47-数据冒险转发与阻塞" class="md-nav__link">
    <span class="md-ellipsis">
      4.7 数据冒险：转发与阻塞
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.7 数据冒险：转发与阻塞">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#471-数据冒险与阻塞" class="md-nav__link">
    <span class="md-ellipsis">
      4.7.1 数据冒险与阻塞
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#48-控制冒险" class="md-nav__link">
    <span class="md-ellipsis">
      4.8 控制冒险
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.8 控制冒险">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#481-假定分支不发生" class="md-nav__link">
    <span class="md-ellipsis">
      4.8.1 假定分支不发生
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#482-缩短分支的延迟" class="md-nav__link">
    <span class="md-ellipsis">
      4.8.2 缩短分支的延迟
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#483-动态分支预测" class="md-nav__link">
    <span class="md-ellipsis">
      4.8.3 动态分支预测
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#484-流水线小结" class="md-nav__link">
    <span class="md-ellipsis">
      4.8.4 流水线小结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#49-异常" class="md-nav__link">
    <span class="md-ellipsis">
      4.9 异常
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.9 异常">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#491-异常在-risc-v-体系结构中的处理" class="md-nav__link">
    <span class="md-ellipsis">
      4.9.1 异常在 RISC-V 体系结构中的处理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#492-在流水线中的异常" class="md-nav__link">
    <span class="md-ellipsis">
      4.9.2 在流水线中的异常
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/WintermelonC/WintermelonC_Docs/edit/main/docs/zju/compulsory_courses/computer_organization/theory/ch4.md" title="编辑此页" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/WintermelonC/WintermelonC_Docs/raw/main/docs/zju/compulsory_courses/computer_organization/theory/ch4.md" title="查看本页的源代码" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="4-the-processor">4 The Processor<a class="headerlink" href="#4-the-processor" title="Permanent link">&para;</a></h1>
<div class="admonition tip">
<p class="admonition-title">说明</p>
<p>此文档正在更新中……</p>
</div>
<div class="admonition info">
<p class="admonition-title">说明</p>
<ol>
<li>部分内容由 AI 翻译课本原文，可能存在错误</li>
<li>本文档只涉及部分知识点，仅可用来复习重点知识</li>
<li>部分课本练习题答案可能存在错误，欢迎在评论区指出</li>
</ol>
<blockquote>
<p>理论课讲到这里的时候，实验课已经把单周期 CPU 都实现了，4.1 - 4.4 理解起来很容易啦，就不过多讲解了。需要注意的是，实验课讲的一些实现方法和这里讲的有些不一样</p>
</blockquote>
</div>
<h2 id="41-引言">4.1 引言<a class="headerlink" href="#41-引言" title="Permanent link">&para;</a></h2>
<p>处理器的实现方式决定了时钟周期长度和 CPI</p>
<h3 id="411-一个基本的-risc-v-实现">4.1.1 一个基本的 RISC-V 实现<a class="headerlink" href="#411-一个基本的-risc-v-实现" title="Permanent link">&para;</a></h3>
<p>核心子集：</p>
<ol>
<li>存储器访问指令：ld，sd</li>
<li>算术逻辑指令：add，sub，and，or</li>
<li>分支指令：beq</li>
</ol>
<h3 id="412-实现方式概述">4.1.2 实现方式概述<a class="headerlink" href="#412-实现方式概述" title="Permanent link">&para;</a></h3>
<p>实现每条指令的前两步是一样的：</p>
<ol>
<li>程序计数器（PC）指向指令所在的存储单元，并从中取出指令</li>
<li>译码，读寄存器</li>
</ol>
<blockquote>
<p>实验课里面，PC 指向指令所在的存储单元就是 ROM。另外，我们 vivado 生成的 ROM，地址为 0 就是取出第一个数据，地址为 1 就是取出第二个数据。但我们让 PC + 4，所以观察 CSSTE 电路图，可以发现 ROM 的地址我们接入的是 PC[11:2]</p>
</blockquote>
<figure>
    <img alt="Img 1" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img1.png" width="600" />
</figure>
<p>加入多选器模块和控制单元：</p>
<figure>
    <img alt="Img 2" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img2.png" width="600" />
</figure>
<h2 id="42-逻辑设计惯例">4.2 逻辑设计惯例<a class="headerlink" href="#42-逻辑设计惯例" title="Permanent link">&para;</a></h2>
<p><strong>状态单元</strong>（state element）：一个存储单元，如寄存器或存储器</p>
<ol>
<li>使用术语 <strong>有效</strong> （asserted），表示逻辑高（1）</li>
<li>使用属于 <strong>无效</strong> （deasserted），表示逻辑低（0）</li>
</ol>
<h3 id="421-时钟方法">4.2.1 时钟方法<a class="headerlink" href="#421-时钟方法" title="Permanent link">&para;</a></h3>
<p><strong>clocking methodology</strong></p>
<h2 id="43-建立数据通路">4.3 建立数据通路<a class="headerlink" href="#43-建立数据通路" title="Permanent link">&para;</a></h2>
<p><strong>building a datapath</strong></p>
<p>用于取指和程序计数器自增的数据通路部分：</p>
<figure>
    <img alt="Img 3" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img3.png" width="600" />
</figure>
<p>处理器的 32 个通用寄存器位于一个叫做 <strong>寄存器堆</strong>（register file）的结构中</p>
<p>实现分支指令的部分：</p>
<figure>
    <img alt="Img 4" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img4.png" width="600" />
</figure>
<blockquote>
<p>实验课实现的数据通路，分支指令的立即数乘以 2 已经在 ImmGen 模块就实现了，不需要后续在左移 1 位 </p>
</blockquote>
<h3 id="431-创建一个简单的数据通路">4.3.1 创建一个简单的数据通路<a class="headerlink" href="#431-创建一个简单的数据通路" title="Permanent link">&para;</a></h3>
<p>实现 R-type 指令和存储指令：</p>
<figure>
    <img alt="Img 5" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img5.png" width="600" />
</figure>
<p>现在，我们将上述三个部分合并：</p>
<figure>
    <img alt="Img 6" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img6.png" width="600" />
</figure>
<details class="question" open="open">
<summary>课本 4.1</summary>
<p>Consider the following instruction:</p>
<p>Instruction: <code>and rd, rs1, rs2</code></p>
<p>Interpretation: <code>Reg[rd] = Reg[rs1] AND Reg[rs2]</code></p>
<p>(1) What are the values of control signals generated by the control in the figure below for this instruction?</p>
<p><figure markdown="span">
    <img alt="Img 5" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img5.png" width="600" />
</figure></p>
<p>(2) Which resources (blocks) perform a useful function for this instruction?</p>
<p>(3) Which resources (blocks) produce no output for this instruction? Which resources produce output that is not used?</p>
<details class="success">
<summary>答案</summary>
<p>(1) <code>RegWrite = true</code> <code>ALUSrc = 0</code> <code>ALU operation = "and"</code> <code>MemWrite = false</code> <code>MemRead = false</code> <code>MemtoReg = 0</code></p>
<hr />
<p>(2) Register file, ALUsrc MUX, ALU, MemToReg MUX</p>
<hr />
<p>(3) All blocks produce some output<br/>
output not used: ImmGen and DataMemory</p>
</details>
</details>
<h2 id="44-一个简单的实现机制">4.4 一个简单的实现机制<a class="headerlink" href="#44-一个简单的实现机制" title="Permanent link">&para;</a></h2>
<h3 id="441-alu-控制">4.4.1 ALU 控制<a class="headerlink" href="#441-alu-控制" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th style="text-align: center;">ALU control lines</th>
<th style="text-align: center;">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">0000</td>
<td style="text-align: center;">AND</td>
</tr>
<tr>
<td style="text-align: center;">0001</td>
<td style="text-align: center;">OR</td>
</tr>
<tr>
<td style="text-align: center;">0010</td>
<td style="text-align: center;">add</td>
</tr>
<tr>
<td style="text-align: center;">0110</td>
<td style="text-align: center;">subtract</td>
</tr>
</tbody>
</table>
<ol>
<li>对于取字和存储字指令，ALU 用加法计算存储器地址</li>
<li>对于 R-type 指令：根据 funct7 和 funct3 选择某个操作</li>
<li>对于 <code>beq</code> 指令：ALU 执行减法操作</li>
</ol>
<figure>
    <img alt="Img 7" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img7.png" width="600" />
</figure>
<p>主控制单元生成 ALUOp 作为 ALU 控制单元的输入，再由 ALU 控制单元生成真正控制 ALU 的信号，这种多级译码的方法是一种常用的实现方式。使用多级译码可以减小主控制单元的规模。使用多个小控制单元还可以提高控制单元的速度。这种优化是很重要的，因为控制单元的性能对减少时钟周期非常关键</p>
<h3 id="442-主控制单元的设计">4.4.2 主控制单元的设计<a class="headerlink" href="#442-主控制单元的设计" title="Permanent link">&para;</a></h3>
<figure>
    <img alt="Img 8" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img8.png" width="600" />
</figure>
<p>控制信号的作用：</p>
<figure>
    <img alt="Img 9" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img9.png" width="600" />
</figure>
<p>包含控制信号的数据通路：</p>
<figure>
    <img alt="Img 10" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img10.png" width="600" />
</figure>
<h3 id="443-数据通路的操作">4.4.3 数据通路的操作<a class="headerlink" href="#443-数据通路的操作" title="Permanent link">&para;</a></h3>
<figure>
    <img alt="Img 11" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img11.png" width="600" />
</figure>
<h3 id="444-控制的结束">4.4.4 控制的结束<a class="headerlink" href="#444-控制的结束" title="Permanent link">&para;</a></h3>
<figure>
    <img alt="Img 12" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img12.png" width="600" />
</figure>
<h3 id="445-为什么不使用单周期实现方式">4.4.5 为什么不使用单周期实现方式<a class="headerlink" href="#445-为什么不使用单周期实现方式" title="Permanent link">&para;</a></h3>
<p>虽然单周期设计也可以正确地工作，但现代设计中并不采取这种方式，因为它的效率太低。究其原因，是在单周期设计中，时钟周期对所有指令等长，这样时钟周期要由执行时间最长的那条指令决定。这条指令几乎肯定是装载指令，它依次使用了5个功能单元：指令存储器、寄存器堆、ALU、数据存储器、寄存器堆。虽然CPI为1（见第1章），单周期实现方式的总体性能并不一定很好，因为时钟周期实在是太长了</p>
<p>使用单周期设计的代价虽然很大，但对于小指令集来说，或许是可以接受的。事实上，早期具有简单指令集的计算机就曾经采用过这种实现方式。然而，若要实现包含浮点或更复杂指令的指令集，这样的单周期设计根本不能胜任</p>
<p>因为时钟周期必须满足所有指令中最坏的情况，故不能使用那些缩短常用指令执行时间而不改善最坏情况的实现技术。这样，单周期实现方式违背了第2章中加快常见情况这一设计原则</p>
<p>在 4.5 节，我们将看到一种称为流水线的实现技术，使用与单周期类似的数据通路，但效率更高。从方法来说，流水线是通过重叠多条指令的执行来提高效率的</p>
<details class="question" open="open">
<summary>课本 4.4</summary>
<p>When silicon chips are fabricated, defects in materials (e.g., silicon) and manufacturing errors can result in defective circuits. A very common defect is for one signal wire to get “broken” and always register a logical 0. This is often called a “stuck-at-0” fault.</p>
<p>(1) Which instructions fail to operate correctly if the MemToReg wire is stuck at 0?</p>
<p>(2) Which instructions fail to operate correctly if the ALUSrc wire is stuck at 0?</p>
<details class="success">
<summary>答案</summary>
<p>(1) MemToReg 一直是 0 的话，写回寄存器组的数据只能是 ALU 的结果，不会是 DataMemory 的结果，所以涉及从内存当中取数的指令都运行不正确</p>
<p><code>loads</code></p>
<hr />
<p>(2) ALUSrc 一直是 0 的话，第二个操作数只能是来自寄存器组的数据，不会是立即数，所以涉及立即数操作的指令都运行不正常</p>
<p><code>I-type</code> <code>loads</code> <code>stores</code></p>
</details>
</details>
<details class="question" open="open">
<summary>课本 4.6</summary>
<p>Section 4.4 does not discuss I-type instructions like addi or andi.</p>
<p>(1) What additional logic blocks, if any, are needed to add I-type instructions to the CPU shown in the figure below? Add any necessary logic blocks to the figure below and explain their purpose.</p>
<p><figure markdown="span">
    <img alt="Img 10" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img10.png" width="600" />
</figure></p>
<p>(2) List the values of the signals generated by the control unit for addi. Explain the reasoning for any “don’t care” control signals.</p>
<details class="success">
<summary>答案</summary>
<p>(1) No additional logic blocks are needed</p>
<blockquote>
<p>无语</p>
</blockquote>
<hr />
<p>(2) <code>Branch = false</code> <code>MemRead = false</code> <code>MemToReg = 0</code> <code>ALUOp = "add"</code> <code>MemWrite = false</code> <code>ALUSrc = 1</code> <code>RegWrite = 1</code></p>
<p>don't care: <code>MemRead</code>，由于 <code>MemToReg</code> 为 0，选择的是 ALU 结果，因此 DataMemory 读不读出数据无所谓</p>
</details>
</details>
<details class="question" open="open">
<summary>课本 4.6</summary>
<p>Problems in this exercise assume that the logic blocks used to implement a processor’s datapath have the following latencies:</p>
<p><figure markdown="span">
    <img alt="Img 51" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img51.png" width="600" />
</figure></p>
<p>“Register read” is the time needed after the rising clock edge for the new register value to appear on the output. This value applies to the PC only. “Register setup” is the amount of time a register’s data input must be stable before the rising edge of the clock. This value applies to both the PC and Register File.</p>
<p>(1) What is the latency of an R-type instruction (i.e., how long must the clock period be to ensure that this instruction works correctly)?</p>
<p>(2) What is the latency of ld? (Check your answer carefully. Many students place extra muxes on the critical path.)</p>
<p>(3) What is the latency of sd? (Check your answer carefully. Many students place extra muxes on the critical path.)</p>
<p>(4) What is the latency of beq?</p>
<p>(5) What is the latency of an I-type instruction?</p>
<p>(6) What is the minimum clock period for this CPU?</p>
<details class="success">
<summary>答案</summary>
<p>(1) <code>RegisterRead + I-Mem + RegisterFile + Mux + ALU + Mux + RegisterSetup = 30 + 250 + 150 + 25 + 200 + 25 + 20 = 700ps</code></p>
<hr />
<p>(2) <code>RegisterRead + I-Mem + RegisterFile + Mux + ALU + D-Mem + Mux + RegisterSetup = 30 + 250 + 150 + 25 + 200 + 250 + 25 + 20 = 950ps</code></p>
<hr />
<p>(3) <code>RegisterRead + I-Mem + RegisterFile + ALU + Mux + D-Mem = 30 + 250 + 150 + 200 + 25 + 250 = 905ps</code></p>
</details>
</details>
<h2 id="45-流水线概述">4.5 流水线概述<a class="headerlink" href="#45-流水线概述" title="Permanent link">&para;</a></h2>
<p><strong>An Overview of Pipelining</strong></p>
<p><strong>流水线</strong>（pipelining）是一种实现多条指令重叠执行的技术</p>
<p>通常，一个 RISC-V 指令包含如下五个处理步骤：</p>
<ol>
<li>从指令存储器中读取指令</li>
<li>指令译码的同时读取寄存器</li>
<li>执行操作或计算地址</li>
<li>从数据存储器中读取操作数（如果需要的话）</li>
<li>将结果写回寄存器（如果需要的话）</li>
</ol>
<div class="admonition example">
<p class="admonition-title">单周期指令模型与流水线性能</p>
<p><figure markdown="span">
    <img alt="Img 13" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img13.png" width="600" />
</figure></p>
<p><figure markdown="span">
    <img alt="Img 14" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img14.png" width="600" />
</figure></p>
</div>
<p>所有的流水级都只花费一个时钟周期的时间，因此，时钟周期必须能够满足最慢操作的执行需要。单周期模型中必须选择最坏情况下的 800 ps 作为时钟周期，流水线执行模型的时钟周期必须选择最坏情况下的 200 ps 作为时钟周期。流水线能够将性能提高 4 倍</p>
<p>如果流水线各阶段操作平衡，那么在流水线机器上的指令执行时间为（在理想情况下）</p>
<div class="arithmatex">\[
Time\ between\ instruction_{pipelined} = \dfrac{Time\ between\ instruction_{nonpipelined}}{Number\ of\ pipe\ stages}
\]</div>
<p>即在理想情况和有大量指令的情况下，流水线所带来的加速比与流水线的级数近似相同。例如一个 5 级流水线能够获得的加速比接近于 5</p>
<p>流水线引入了一些开销。所以，在流水线机器中每一条指令的执行时间会超过这个最小的可能值，因此流水线能够获得的加速比也就小于流水线的级数</p>
<p>流水线所带来的性能提高是通过增加指令的吞吐率，而不是减少单条指令的执行时间实现的</p>
<h3 id="451-面向流水线的指令集设计">4.5.1 面向流水线的指令集设计<a class="headerlink" href="#451-面向流水线的指令集设计" title="Permanent link">&para;</a></h3>
<h3 id="452-流水线冒险">4.5.2 流水线冒险<a class="headerlink" href="#452-流水线冒险" title="Permanent link">&para;</a></h3>
<p><strong>Pipeline Hazards</strong></p>
<p>在下一个时钟周期中下一条指令不能执行。这种情况称为 <strong>冒险</strong>（hazard）</p>
<h4 id="结构冒险">结构冒险<a class="headerlink" href="#结构冒险" title="Permanent link">&para;</a></h4>
<p><strong>Structural Hazard</strong></p>
<p>硬件不支持多条指令在同一时钟周期执行</p>
<h4 id="数据冒险">数据冒险<a class="headerlink" href="#数据冒险" title="Permanent link">&para;</a></h4>
<p><strong>Data Hazards</strong></p>
<p><strong>数据冒险</strong> 发生在由于一条指令必须等待另一条指令的完成而造成流水线暂停的情况下</p>
<p>在计算机流水线中，数据冒险是由于一条指令依赖于更早的一条还在流水线中的指令造成的。比如有一条减法指令需要使用上一条加法指令的结果</p>
<div class="language-verilog highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="n">add</span><span class="w"> </span><span class="n">x19</span><span class="p">,</span><span class="w"> </span><span class="n">x0</span><span class="p">,</span><span class="w"> </span><span class="n">x1</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="n">sub</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="n">x19</span><span class="p">,</span><span class="w"> </span><span class="n">x3</span>
</span></code></pre></div></td></tr></table></div>
<p>一种最基本的解决方法：对于上述的代码序列，一旦 ALU 生成了加法运算的结果，就可以将它用作减法运算的一个输入项。从内部资源中直接提前得到缺少的运算项的过程称为 <strong>转发</strong>（forwarding） 或者 <strong>旁路</strong>（bypassing）</p>
<div class="admonition example">
<p class="admonition-title">两条指令间的转发</p>
<p><figure markdown="span">
    <img alt="Img 15" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img15.png" width="600" />
</figure></p>
<p><figure markdown="span">
    <img alt="Img 16" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img16.png" width="600" />
</figure></p>
<p><figure markdown="span">
    <img alt="Img 17" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img17.png" width="600" />
</figure></p>
</div>
<p class="annotate">转发可以工作得很好，然而它并不能够避免所有流水线阻塞的发生。如下图所示，即使采用了转发机制，在遇到 <strong>装载-使用型数据冒险</strong> (1) （load-use data hazard）时，流水线不得不阻塞一个步骤。图中显示了一个重要的流水线概念，正式的叫法是 <strong>流水线阻塞</strong>（pipeline），但是它经常被昵称为气泡（bubble）</p>
<ol>
<li>一类特殊的数据冒险，指当装载指令要取的数还没取回来时其他指令就需要使用的情况</li>
</ol>
<figure>
    <img alt="Img 18" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img18.png" width="600" />
</figure>
<div class="admonition example">
<p class="admonition-title">重新安排代码以避免流水线阻塞</p>
<p>考虑此 C 代码：</p>
<div class="language-c highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">c</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">e</span><span class="p">;</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">f</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<p>对应的 RISC-V 指令，假设所有的变量都在存储器中，且以 x10 为基址进行寻址：</p>
<div class="language-verilog highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">RISC-V</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span>
<span class="normal"><a href="#__codelineno-2-4">4</a></span>
<span class="normal"><a href="#__codelineno-2-5">5</a></span>
<span class="normal"><a href="#__codelineno-2-6">6</a></span>
<span class="normal"><a href="#__codelineno-2-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="n">ld</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="mh">0</span><span class="p">(</span><span class="n">x31</span><span class="p">)</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="hll"><span class="n">ld</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="mh">8</span><span class="p">(</span><span class="n">x31</span><span class="p">)</span>
</span></span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="hll"><span class="n">add</span><span class="w"> </span><span class="n">x3</span><span class="p">,</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">x2</span>
</span></span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="n">sd</span><span class="w"> </span><span class="n">x3</span><span class="p">,</span><span class="w"> </span><span class="mh">24</span><span class="p">(</span><span class="n">x31</span><span class="p">)</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="hll"><span class="n">ld</span><span class="w"> </span><span class="n">x4</span><span class="p">,</span><span class="w"> </span><span class="mh">16</span><span class="p">(</span><span class="n">x31</span><span class="p">)</span>
</span></span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="hll"><span class="n">add</span><span class="w"> </span><span class="n">x5</span><span class="p">,</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">x4</span>
</span></span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="n">sd</span><span class="w"> </span><span class="n">x5</span><span class="p">,</span><span class="w"> </span><span class="mh">32</span><span class="p">(</span><span class="n">x31</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p>两条 add 指令都存在冒险，因为他们都依赖于上一条 ld 指令。通过将第三条 ld 指令提前可以消除所有的冒险</p>
<div class="language-verilog highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">RISC-V</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span>
<span class="normal"><a href="#__codelineno-3-4">4</a></span>
<span class="normal"><a href="#__codelineno-3-5">5</a></span>
<span class="normal"><a href="#__codelineno-3-6">6</a></span>
<span class="normal"><a href="#__codelineno-3-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="n">ld</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="mh">0</span><span class="p">(</span><span class="n">x31</span><span class="p">)</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="n">ld</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="mh">8</span><span class="p">(</span><span class="n">x31</span><span class="p">)</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="n">ld</span><span class="w"> </span><span class="n">x4</span><span class="p">,</span><span class="w"> </span><span class="mh">16</span><span class="p">(</span><span class="n">x31</span><span class="p">)</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="n">add</span><span class="w"> </span><span class="n">x3</span><span class="p">,</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">x2</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="n">sd</span><span class="w"> </span><span class="n">x3</span><span class="p">,</span><span class="w"> </span><span class="mh">24</span><span class="p">(</span><span class="n">x31</span><span class="p">)</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="n">add</span><span class="w"> </span><span class="n">x5</span><span class="p">,</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">x4</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="n">sd</span><span class="w"> </span><span class="n">x5</span><span class="p">,</span><span class="w"> </span><span class="mh">32</span><span class="p">(</span><span class="n">x31</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</div>
<h4 id="控制冒险">控制冒险<a class="headerlink" href="#控制冒险" title="Permanent link">&para;</a></h4>
<p><strong>Control Hazards</strong></p>
<p>控制冒险也称为 <strong>分支冒险</strong>（branch hazard）。控制冒险发生在决策依赖于一条指令的结果，而其正在执行中。计算机中的决策就是分支指令。在去分支指令之后，紧跟着就会取下一条指令。但是流水线并不知道下一条真正要执行的指令在哪里，因为它才刚刚从指令存储器中把分支指令给取出来</p>
<p>一种可能的解决方法是取分支指令后立即 <strong>阻塞</strong>（stall）流水线，直到流水线确定分支指令的结果并指导下一条真正要执行的指令在哪为止</p>
<figure>
    <img alt="Img 19" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img19.png" width="600" />
</figure>
<div class="admonition example">
<p class="admonition-title">阻塞对分支性能的影响</p>
<p>假设其他所有指令的 CPI 都为 1，分支指令约占执行指令的 17%。分支指令阻塞要多一个时钟周期，因此平均 CPI 为 1.17</p>
</div>
<p>如果不能在第二级解决分支问题，那么分支结构上的阻塞将导致更大的速度下降。对很多计算机来说，这种阻塞的方法代价太大，因此也就产生了另外一种消除控制冒险的方法</p>
<p><strong>预测：</strong>（predict）一种简单的预测方法讲就是总预测分支未发生。当预测正确的时候，流水线会全速地执行。只有当分支发生时流水线才会阻塞</p>
<figure>
    <img alt="Img 20" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img20.png" width="600" />
</figure>
<figure>
    <img alt="Img 21" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img21.png" width="500" />
</figure>
<p>一种更加成熟的分支预测方法是预测一些分支发生而预测另一些分支不发生。在计算机程序中，循环体底部的分支总是会跳回到循环体的顶部。在此种情况下，由于分支总是发生并且向前跳转，因此我们可以预测分支会跳转到前面的某一地址处</p>
<p>这种分支预测方法依赖于始终不变的行为，它没有考虑特定分支指令的特点。<strong>动态</strong>（Dynamic）硬件预测其与这种方法截然不同，它的预测取决于每一条指令的行为，并且在整个程序生命期内可能改变分支的预测结果</p>
<p>计算机中动态预测方法的一种比较普遍的实现方式是保存每次分支的历史记录，然后利用这个历史记录来预测。稍后我们将看到，历史记录的数量和类型足够多时，这种硬件预测分支的方式能够达到 90% 的正确率。当预测错误时，流水线控制必须确保被错误预测的分支后面的指令执行不会生效，并且必须在正确的分支地址处重新开始启动流水线</p>
<p>如同其他解决控制冒险的方法一样，较长的流水线会恶化预测的性能，并会提高错误预测的代价</p>
<h2 id="46-流水线数据通路及其控制">4.6 流水线数据通路及其控制<a class="headerlink" href="#46-流水线数据通路及其控制" title="Permanent link">&para;</a></h2>
<p>将指令划分为五个阶段意味着一个流水线采用五级</p>
<figure>
    <img alt="Img 22" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img22.png" width="800" />
</figure>
<ol>
<li>IF：取指令</li>
<li>ID：指令译码，读寄存器堆</li>
<li>EX：执行或计算地址</li>
<li>MEM：存储器访问</li>
<li>WB：写回</li>
</ol>
<p>然而，在从左到右的指令流中有两个例外：</p>
<ul>
<li>写回阶段，它把结果写回数据通路中间的寄存器堆中</li>
<li>选择 PC 的下一个值时，需在自增的 PC 和 MEM 级的分支地址间进行选择</li>
</ul>
<p>这两个从右向左的数据流不会影响当前指令；只有当前指令以后的指令才会受到这种数据反向活动的影响。需要注意的是第一个例外会导致数据冒险，而第二个会导致控制冒险</p>
<figure>
    <img alt="Img 23" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img23.png" width="800" />
</figure>
<p>在两个阶段之间添加寄存器来存储指令和相应的变量</p>
<p>分析 <code>ld</code> 指令：</p>
<figure>
    <img alt="Img 24" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img24.png" width="800" />
    <div style="text-align: left">
        <strong>取指令：</strong> 图中表示指令使用 PC（程序计数器）中的地址从存储器中读取数据，然后将数据放入 IF/ID 流水线寄存器中。PC 地址加 4 然后写回 PC 以便为下个时钟周期做好准备。增加后的地址同时也存入了 IF/ID 流水线寄存器中以备后面的指令使用（如 beq）。计算机并不知道所取指令的类型，所以必须考虑到所有可能的指令，并沿流水线传递所有可能有用的信息
    </div>
</figure>
<figure>
    <img alt="Img 25" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img25.png" width="800" />
    <div style="text-align: left">
        <strong>指令译码与寄存器堆的读取：</strong> 图中显示的是 IF/ID 流水线寄存器的指令部分，其中包括一个 64 位的立即数和两个寄存器号（用于读取寄存器）。这三个值和自增的 PC 地址一起存入 ID/EX 流水线寄存器中。这里同样必须传递后面指令可能需要的所有信息
    </div>
</figure>
<figure>
    <img alt="Img 26" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img26.png" width="800" />
    <div style="text-align: left">
        <strong>执行或者地址计算：</strong> 图中表示装载指令从 ID/EX 流水线寄存器中读取由寄存器 1 传过来的值以及经符号扩展后的立即数，并用 ALU 将它们相加，和值存入 EX/MEM 流水线寄存器中
    </div>
</figure>
<figure>
    <img alt="Img 27" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img27.png" width="800" />
    <div style="text-align: left">
        <strong>存储器访问：</strong> 图中表示装载指令使用从 EX/MEM 流水线寄存器中得到的地址读取数据存储器，并将数据存入 MEM/WB 流水线寄存器中
    </div>
</figure>
<figure>
    <img alt="Img 28" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img28.png" width="800" />
    <div style="text-align: left">
      <strong>写回：</strong> 图中表示了最后一个步骤，即从 MEM/WB 流水线寄存器中读取数据并将它写回寄存器堆
    </div>
</figure>
<p>但其实在上述过程中有错误，在装载指令执行的最后一级写回了哪个寄存器呢？更确切地说，哪条指令提供了写寄存器号呢？在 IF/ID 流水线寄存器中的指令提供了写寄存器号，但是很显然现在这条指令已经是装载指令之后的指令了</p>
<p>因此，我们要在装载指令中保存目的寄存器号。就像存储指令为了 MEM 的需要将寄存器的内容从 ID/EX 传送到 EX/MEM 中一样，为了 WB 级使用的需要，装载指令必须把寄存器号从 ID/EX 经过 EX/MEM 传送到 MEM/WB 中。从另一个角度来考虑寄存器号的传递，为了共享流水线的数据通路，我们需要在 IF 中保存读取的指令，因此每一个流水线寄存器都要保存当前和后续流水级所需的部分指令</p>
<p>下图给出了修正后的数据通路。首先将写寄存器号传送到 ID/EX 寄存器，然后送到 EX/MEM 寄存器，最后送到 MEM/WB 寄存器。在 WB 级使用寄存器号指定了要写入的寄存器</p>
<figure>
    <img alt="Img 29" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img29.png" width="800" />
</figure>
<h3 id="461-图形化表示流水线">4.6.1 图形化表示流水线<a class="headerlink" href="#461-图形化表示流水线" title="Permanent link">&para;</a></h3>
<figure>
    <img alt="Img 30" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img30.png" width="800" />
</figure>
<h3 id="462-流水线控制">4.6.2 流水线控制<a class="headerlink" href="#462-流水线控制" title="Permanent link">&para;</a></h3>
<figure>
    <img alt="Img 31" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img31.png" width="800" />
</figure>
<p>为了详细说明流水线的控制问题，我们只需要在每一个流水级中都设置相应的控制信号。由于每一个控制信号只与某个流水级中的某个功能单元相关，因此我们可以根据流水线的五级将控制信号分成五组</p>
<ol>
<li><strong>取指令</strong>：读指令存储器和写PC的控制信号总是有效的，因此在取指阶段没有特别需要控制的内容</li>
<li><strong>指令译码/寄存器堆读</strong>：与第一步类似，在每个时钟周期内本阶段所做的工作都是完全相同的，因此不需要设置控制信号</li>
<li><strong>指令执行/地址计算</strong>：控制信号有 ALUOp 和 ALUSrc（见图4-47和图4-48）。根据这些信号选择结果寄存器、ALU 操作，并为 ALU 读取数据2或符号扩展后的立即数</li>
<li><strong>存储器访问</strong>：这一步的控制信号有 Branch、MemRead 和 MemWrite。这些控制信号分别由相等则分支、装载指令和存储指令设置。除非控制电路断言是一条分支指令并且 ALU 结果为0，否则将选择线性地址中的下一条指令作为图4-48中的PCSrc信号</li>
<li><strong>写回</strong>：控制信号有 MemtoReg 和 RegWrite，其中前者决定是将 ALU 结果还是将存储器数据传送到寄存器堆，后者决定是否写入寄存器堆</li>
</ol>
<figure>
    <img alt="Img 32" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img32.png" width="800" />
</figure>
<figure>
    <img alt="Img 33" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img33.png" width="800" />
</figure>
<h2 id="47-数据冒险转发与阻塞">4.7 数据冒险：转发与阻塞<a class="headerlink" href="#47-数据冒险转发与阻塞" title="Permanent link">&para;</a></h2>
<p><strong>Data Hazard: Forwarding versus Stalling</strong></p>
<figure>
    <img alt="Img 34" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img34.png" width="800" />
</figure>
<p>4 个冒险条件：</p>
<p>1a. EX/MEM.RegisterRd = ID/EX.RegisterRs1<br/>
1b. EX/MEM.RegisterRd = ID/EX.RegisterRs2<br/>
2a. MEM/WB.RegisterRd = ID/EX.RegisterRs1<br/>
2b. MEM/WB.RegisterRd = ID/EX.RegisterRs2</p>
<p>上述例子中：</p>
<ol>
<li>sub-and 是 1a 冒险</li>
<li>sub-or 是 2b 冒险</li>
</ol>
<p>可通过转发来解决</p>
<figure>
    <img alt="Img 35" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img35.png" width="800" />
</figure>
<p>添加转发机制：</p>
<figure>
    <img alt="Img 36" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img36.png" width="600" />
</figure>
<figure>
    <img alt="Img 37" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img37.png" width="600" />
</figure>
<p><strong>EX 冒险：</strong></p>
<ol>
<li>直接采用总是转发的方式解决冒险是不正确的，因为某些指令可能不写回寄存器，就会产生一些不必要的转发。一种简单的解决方法是检测 RegWrite 信号是否是活动的</li>
<li>x0 寄存器始终为 0，必须避免把 x0 按非零结果转发</li>
</ol>
<div class="language-c highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">EX</span><span class="o">/</span><span class="n">MEM</span><span class="p">.</span><span class="n">RegWrite</span><span class="w"> </span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">EX</span><span class="o">/</span><span class="n">MEM</span><span class="p">.</span><span class="n">RegisterRd</span><span class="w"> </span><span class="err">≠</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">EX</span><span class="o">/</span><span class="n">MEM</span><span class="p">.</span><span class="n">RegisterRd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ID</span><span class="o">/</span><span class="n">EX</span><span class="p">.</span><span class="n">RegisterRs1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="w">    </span><span class="n">ForwardA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="p">}</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6"></a>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">EX</span><span class="o">/</span><span class="n">MEM</span><span class="p">.</span><span class="n">RegWrite</span><span class="w"> </span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">EX</span><span class="o">/</span><span class="n">MEM</span><span class="p">.</span><span class="n">RegisterRd</span><span class="w"> </span><span class="err">≠</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">EX</span><span class="o">/</span><span class="n">MEM</span><span class="p">.</span><span class="n">RegisterRd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ID</span><span class="o">/</span><span class="n">EX</span><span class="p">.</span><span class="n">RegisterRs2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="w">    </span><span class="n">ForwardB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<p><strong>MEM 冒险：</strong></p>
<p>更为复杂的潜在数据冒险发生在 WB 级的指令结果、MEM 级的指令结果和 ALU 级的指令源操作数之间。例如，在一个寄存器中对多个数字进行求和运算时，一系列连续的指令将会读写到同一寄存器：</p>
<div class="language-verilog highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span>
<span class="normal"><a href="#__codelineno-5-3">3</a></span>
<span class="normal"><a href="#__codelineno-5-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="n">add</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">x2</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="n">add</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">x3</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="n">add</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">x4</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="p">......</span>
</span></code></pre></div></td></tr></table></div>
<p>在这种情况下，由于 MEM 级的结果是最新的，因而结果是由 MEM 级转发得到，因而需要添加一些控制条件，用行高亮表示</p>
<div class="language-c highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">MEM</span><span class="o">/</span><span class="n">WB</span><span class="p">.</span><span class="n">RegWrite</span><span class="w"> </span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">MEM</span><span class="o">/</span><span class="n">WB</span><span class="p">.</span><span class="n">RegisterRd</span><span class="w"> </span><span class="err">≠</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="hll"><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="n">EX</span><span class="o">/</span><span class="n">MEM</span><span class="p">.</span><span class="n">RegWrite</span>
</span></span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="hll"><span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">EX</span><span class="o">/</span><span class="n">MEM</span><span class="p">.</span><span class="n">RegisterRd</span><span class="w"> </span><span class="err">≠</span><span class="w"> </span><span class="mi">0</span>
</span></span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="hll"><span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">EX</span><span class="o">/</span><span class="n">MEM</span><span class="p">.</span><span class="n">RegisterRd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ID</span><span class="o">/</span><span class="n">EX</span><span class="p">.</span><span class="n">RegisterRs1</span><span class="p">)</span>
</span></span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">MEM</span><span class="o">/</span><span class="n">WB</span><span class="p">.</span><span class="n">RegisterRd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ID</span><span class="o">/</span><span class="n">EX</span><span class="p">.</span><span class="n">RegisterRs1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="w">    </span><span class="n">ForwardA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">01</span><span class="p">;</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="p">}</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9"></a>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">MEM</span><span class="o">/</span><span class="n">WB</span><span class="p">.</span><span class="n">RegWrite</span><span class="w"> </span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">MEM</span><span class="o">/</span><span class="n">WB</span><span class="p">.</span><span class="n">RegisterRd</span><span class="w"> </span><span class="err">≠</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="hll"><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="n">EX</span><span class="o">/</span><span class="n">MEM</span><span class="p">.</span><span class="n">RegWrite</span>
</span></span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="hll"><span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">EX</span><span class="o">/</span><span class="n">MEM</span><span class="p">.</span><span class="n">RegisterRd</span><span class="w"> </span><span class="err">≠</span><span class="w"> </span><span class="mi">0</span>
</span></span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="hll"><span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">EX</span><span class="o">/</span><span class="n">MEM</span><span class="p">.</span><span class="n">RegisterRd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ID</span><span class="o">/</span><span class="n">EX</span><span class="p">.</span><span class="n">RegisterRs2</span><span class="p">)</span>
</span></span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">MEM</span><span class="o">/</span><span class="n">WB</span><span class="p">.</span><span class="n">RegisterRd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ID</span><span class="o">/</span><span class="n">EX</span><span class="p">.</span><span class="n">RegisterRs2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="w">    </span><span class="n">ForwardB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">01</span><span class="p">;</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<p>添加支持转发的硬件：</p>
<figure>
    <img alt="Img 38" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img38.png" width="800" />
</figure>
<p>添加在寄存器和立即数之间的选择器：</p>
<figure>
    <img alt="Img 39" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img39.png" width="800" />
</figure>
<h3 id="471-数据冒险与阻塞">4.7.1 数据冒险与阻塞<a class="headerlink" href="#471-数据冒险与阻塞" title="Permanent link">&para;</a></h3>
<p><strong>Data Hazards and Stalls</strong></p>
<p>如上文所说的，当一条指令试图读取一个由前一条装载指令读入的寄存器时，就无法使用转发解决冒险了</p>
<figure>
    <img alt="Img 40" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img40.png" width="800" />
</figure>
<p><strong>冒险检测单元</strong>，工作在 ID 级，控制条件：</p>
<div class="language-c highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span>
<span class="normal"><a href="#__codelineno-7-2">2</a></span>
<span class="normal"><a href="#__codelineno-7-3">3</a></span>
<span class="normal"><a href="#__codelineno-7-4">4</a></span>
<span class="normal"><a href="#__codelineno-7-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ID</span><span class="o">/</span><span class="n">EX</span><span class="p">.</span><span class="n">MemRead</span><span class="w"> </span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">ID</span><span class="o">/</span><span class="n">EX</span><span class="p">.</span><span class="n">RegisterRd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">IF</span><span class="o">/</span><span class="n">ID</span><span class="p">.</span><span class="n">RegisterRs1</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="w">    </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">ID</span><span class="o">/</span><span class="n">EX</span><span class="p">.</span><span class="n">RegisterRd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">IF</span><span class="o">/</span><span class="n">ID</span><span class="p">.</span><span class="n">RegisterRs2</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="w">    </span><span class="n">stall</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">pipeline</span><span class="p">;</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<p>如果条件成立，指令将阻塞一个时钟周期。经过这一个周期的阻塞，转发逻辑就可以处理相关性并继续执行程序了</p>
<p>如果处于 ID 级的指令被阻塞，那么处于 IF 级的指令也必须被阻塞，否则，已经取到的指令就会丢失。防止这两条指令继续执行的方法是保持 PC 寄存器和 IF/ID 流水线寄存器不变。如果这些寄存器内容保持不变，在 IF 级的指令将继续使用相同的 PC 取指令，而在 ID 级将继续使用 IF/ID 流水线寄存器中的相同的指令字段读寄存器堆</p>
<p>在 EX、MEM 和 WB 级如果将所有 7 个控制信号都清除（置为0），就会产生一个“什么都不做”的指令，即空指令。通过识别 ID 级的冒险，可以在流水线中插入一个气泡，方法是把 ID/EX 流水线寄存器的 EX、MEM 和 WB 级的控制信号都置为 0。这些控制信号在每个时钟周期都向前传递，但不会产生不良后果，因为如果控制信号都是 0 的话，所有寄存器和存储器都不进行写操作</p>
<p>与 AND 指令相关的流水线执行槽被插入一条空指令，这样从 AND 开始的所有指令都被延迟一个时钟周期。就像水管中的气泡，一个阻塞的气泡会延缓后面所有指令的执行，同时在每个时钟周期，气泡也沿着流水线向后推进一级，直到它退出流水线为止。在这个例子中，冒险强迫指令 AND 和 OR 在第4个时钟周期重复第3个时钟周期所做的内容，即指令 AND 读存储器并进行译码，指令 OR 从存储器中取指令。这种重复的工作就像阻塞一样，但它的效果是拉伸了指令 AND 和 OR，并且延迟了第二个 add 指令的取数操作</p>
<figure>
    <img alt="Img 41" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img41.png" width="800" />
</figure>
<figure>
    <img alt="Img 42" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img42.png" width="800" />
</figure>
<h2 id="48-控制冒险">4.8 控制冒险<a class="headerlink" href="#48-控制冒险" title="Permanent link">&para;</a></h2>
<p><strong>Branch Hazard</strong></p>
<figure>
    <img alt="Img 43" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img43.png" width="800" />
</figure>
<h3 id="481-假定分支不发生">4.8.1 假定分支不发生<a class="headerlink" href="#481-假定分支不发生" title="Permanent link">&para;</a></h3>
<p>采用阻塞直到分支判断完毕来处理控制冒险的速度实在太慢。一种比较普遍的提高速度的方法是假设分支不发生，并继续执行顺序的指令流。如果分支发生的话，就丢弃已经读取并译码的指令，并按分支目标继续执行。如果分支不发生的可能性是 50%，同时丢弃指令的代价很小的话，那么这种优化方法可以将控制冒险的代价减半</p>
<p>为了丢弃指令，只需要将最初的控制信号置为 0 即可，这一点与阻塞解决装载指令的数据冒险类似。其不同之处在于当分支到达 MEM 级时必须分别改变在 IF、ID 和 EX 级的三条指令的控制信号，而对于装载指令的阻塞只需要将ID级的控制信号置为 0，并将其从流水线中退出即可。分支冒险中的丢弃指令意味着必须能够将流水线的 IF、ID 和 EX 级的指令都清除</p>
<h3 id="482-缩短分支的延迟">4.8.2 缩短分支的延迟<a class="headerlink" href="#482-缩短分支的延迟" title="Permanent link">&para;</a></h3>
<p>将分支地址计算指令提前到 ID 级</p>
<p>为了在 IF 级清除指令，我们加入了一条称为 IF.Flush 的控制信号，即将 IF/ID 流水线寄存器的指令字段置为 0。清空寄存器的结果是将预取到的指令转变为空指令</p>
<div class="admonition example">
<p class="admonition-title">流水线分支</p>
<p>假定流水线对分支不发生进行了优化，并且分支的执行提前到流水线的 ID 级。试说明下面的指令序列在分支发生时的执行情况：</p>
<div class="language-verilog highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span>
<span class="normal"><a href="#__codelineno-8-3">3</a></span>
<span class="normal"><a href="#__codelineno-8-4">4</a></span>
<span class="normal"><a href="#__codelineno-8-5">5</a></span>
<span class="normal"><a href="#__codelineno-8-6">6</a></span>
<span class="normal"><a href="#__codelineno-8-7">7</a></span>
<span class="normal"><a href="#__codelineno-8-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="mh">36</span><span class="w"> </span><span class="n">sub</span><span class="w"> </span><span class="n">x10</span><span class="p">,</span><span class="w"> </span><span class="n">x4</span><span class="p">,</span><span class="w"> </span><span class="n">x8</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="mh">40</span><span class="w"> </span><span class="n">beq</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">x3</span><span class="p">,</span><span class="w"> </span><span class="mh">16</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="mh">44</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">x12</span><span class="p">,</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="n">x5</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="mh">48</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">x13</span><span class="p">,</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="n">x6</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="mh">52</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">x14</span><span class="p">,</span><span class="w"> </span><span class="n">x4</span><span class="p">,</span><span class="w"> </span><span class="n">x2</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="mh">56</span><span class="w"> </span><span class="n">sub</span><span class="w"> </span><span class="n">x15</span><span class="p">,</span><span class="w"> </span><span class="n">x6</span><span class="p">,</span><span class="w"> </span><span class="n">x7</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="err">···</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="mh">72</span><span class="w"> </span><span class="n">ld</span><span class="w"> </span><span class="n">x4</span><span class="p">,</span><span class="w"> </span><span class="mh">50</span><span class="p">(</span><span class="n">x7</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p><figure markdown="span">
    <img alt="Img 50" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img50.png" width="800" />
</figure></p>
</div>
<h3 id="483-动态分支预测">4.8.3 动态分支预测<a class="headerlink" href="#483-动态分支预测" title="Permanent link">&para;</a></h3>
<p><strong>Dynamic Branch Prediction</strong></p>
<p>一种策略是通过查找指令的地址观察上一次执行该指令时分支是否发生，如果上次执行时分支发生就从上次分支发生的地方开始取新的指令。这种技术称为 <strong>动态分支预测</strong> </p>
<p>这种策略的一种实现方法就是采用 <strong>分支预测缓存</strong> 或分支历史记录表。分支预测缓存是一小块按照分支指令的地址低位索引的存储器区，其中包括一位或多位数据用以说明最近是否发生过分支</p>
<p>这是最简单的一类缓存，我们实际上并不知道预测是否正确，而且它还可能由其他具有相同地址低位的分支设置，但这并不影响这种方法的准确率。预测只是对正确分支方向的一种假设，在这个基础上，沿着预测的方向进行取指，如果这种假设错误，预测错误的指令将被删除，预测位将取反，并返回原来的位置，继续按照正确的方向取指并执行</p>
<figure>
    <img alt="Img 44" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img44.png" width="600" />
</figure>
<h3 id="484-流水线小结">4.8.4 流水线小结<a class="headerlink" href="#484-流水线小结" title="Permanent link">&para;</a></h3>
<figure>
    <img alt="Img 45" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img45.png" width="800" />
</figure>
<h2 id="49-异常">4.9 异常<a class="headerlink" href="#49-异常" title="Permanent link">&para;</a></h2>
<p><strong>Exception</strong></p>
<p>控制中最难的部分之一是实现 <strong>异常</strong>（exception）和 <strong>中断</strong>（interrupt）—— 除分支以外改变正常指令执行顺序的事件</p>
<p>我们使用术语 <em>异常</em> 指控制流中任何意外的改变，而无论其产生的原因是来自处理器内部还是外部，术语 <em>中断</em> 指由外部引起的事件</p>
<figure>
    <img alt="Img 46" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img46.png" width="600" />
</figure>
<h3 id="491-异常在-risc-v-体系结构中的处理">4.9.1 异常在 RISC-V 体系结构中的处理<a class="headerlink" href="#491-异常在-risc-v-体系结构中的处理" title="Permanent link">&para;</a></h3>
<p>异常发生时处理器必须进行的基本操作是：在异常程序计数器（SEPC）中保存出错指令的地址，并把控制权转交给操作系统的特定地址</p>
<p>为了处理异常，操作系统除了要知道是哪条指令引起异常之外，还必须知道引起异常的原因。主要有两种方法用于表示产生异常的原因。RISC-V 使用的方法是设置一个状态寄存器（SCAUSE），其中有一个字段用于记录异常产生的原因</p>
<p>另一种方法是使用 <strong>向量中断</strong>（vectored interrupt）。在向量中断中，控制权被转移到由异常原因决定的地址处</p>
<figure>
    <img alt="Img 47" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img47.png" width="600" />
</figure>
<h3 id="492-在流水线中的异常">4.9.2 在流水线中的异常<a class="headerlink" href="#492-在流水线中的异常" title="Permanent link">&para;</a></h3>
<figure>
    <img alt="Img 48" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img48.png" width="800" />
</figure>
<p>在处理分支预测错误时，我们已经知道如何通过将 IF 级的指令转换成 nop 指令来清除指令。为了清除 ID 级的指令，我们使用 ID 级已有的多选器，将控制信号清零以产生阻塞。一个称为 ID.Flush 的新控制信号与冒险检测单元的阻塞信号相或，可以在 ID 级进行清除。为了清除 EX 级的指令，我们使用一个称为 EX.Flush 的新信号，用它控制新的多选器将控制信号清零。为了从地址 1C09 0000₁₆（某个异常地址）开始取指令，只要简单地加入一个额外的输入到 PC 的多选器，由它将 1C09 0000₁₆ 传递到 PC</p>
<p>异常处理的最后一步是将导致异常的指令的地址保存到 SEPC 中</p>
<div class="admonition example">
<p class="admonition-title">流水线处理器中的异常</p>
<p>给出以下指令序列：</p>
<div class="language-verilog highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span>
<span class="normal"><a href="#__codelineno-9-3">3</a></span>
<span class="normal"><a href="#__codelineno-9-4">4</a></span>
<span class="normal"><a href="#__codelineno-9-5">5</a></span>
<span class="normal"><a href="#__codelineno-9-6">6</a></span>
<span class="normal"><a href="#__codelineno-9-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="mh">40</span><span class="w"> </span><span class="n">sub</span><span class="w"> </span><span class="n">x11</span><span class="p">,</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="n">x4</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="mh">44</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">x12</span><span class="p">,</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="n">x5</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="mh">48</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">x13</span><span class="p">,</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="n">xx6</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="mh">4</span><span class="n">C</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="n">x1</span><span class="w">  </span><span class="c1">// 该 add 指令发生溢出</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="mh">50</span><span class="w"> </span><span class="n">sub</span><span class="w"> </span><span class="n">x15</span><span class="p">,</span><span class="w"> </span><span class="n">x6</span><span class="p">,</span><span class="w"> </span><span class="n">x7</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="mh">54</span><span class="w"> </span><span class="n">ld</span><span class="w"> </span><span class="n">x16</span><span class="p">,</span><span class="w"> </span><span class="mh">100</span><span class="p">(</span><span class="n">x7</span><span class="p">)</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="err">···</span>
</span></code></pre></div></td></tr></table></div>
<p>假定异常处理程序的开始部分如下：</p>
<div class="language-verilog highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span>
<span class="normal"><a href="#__codelineno-10-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="mh">1</span><span class="n">C09_0000</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="n">x26</span><span class="p">,</span><span class="w"> </span><span class="mh">1000</span><span class="p">(</span><span class="n">x10</span><span class="p">)</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="mh">1</span><span class="n">C09_0004</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="n">x27</span><span class="p">,</span><span class="w"> </span><span class="mh">1008</span><span class="p">(</span><span class="n">x10</span><span class="p">)</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="err">···</span>
</span></code></pre></div></td></tr></table></div>
<p>给出 add 指令发生溢出异常时流水线的情况</p>
<p><figure markdown="span">
    <img alt="Img 49" src="../../../../../img/computer_organization/theory/ch4/comp_ch4_img49.png" width="800" />
</figure></p>
<ol>
<li>clock 6：溢出在 EX 级被检测到，1C09_0000 被强制放入 PC</li>
<li>clock 7：add 指令及其后面的指令被清除，并且异常代码的第一条指令被取出（即 <code>sd x26, 1000(x10)</code>）</li>
</ol>
<p>注意，SEPC 中保存的地址是 add 指令地址 4C</p>
</div>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="最后更新">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2024年12月6日</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="创建日期">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2024年11月16日</span>
  </span>

    
    
    
  </aside>




<div id="__comments">

<h2>评论区</h2>

<div>欢迎在评论区指出文档错误，或为文档提供宝贵意见</div>

<br/>

<!-- Insert generated snippet here -->
<script src="https://giscus.app/client.js"
  data-repo="WintermelonC/WintermelonC_Docs"
  data-repo-id="R_kgDOM7yCjg"
  data-category="General"
  data-category-id="DIC_kwDOM7yCjs4Cj6RZ"
  data-mapping="pathname"
  data-strict="0"
  data-reactions-enabled="1"
  data-emit-metadata="0"
  data-input-position="top"
  data-theme="preferred_color_scheme"
  data-lang="zh-CN"
  crossorigin="anonymous"
  async>
</script>

<!-- Synchronize Giscus theme with palette -->
<script>
  var giscus = document.querySelector("script[src*=giscus]")

  // Set palette on initial load
  var palette = __md_get("__palette")
  if (palette && typeof palette.color === "object") {
    var theme = palette.color.scheme === "slate"
      ? "transparent_dark"
      : "light"

    // Instruct Giscus to set theme
    giscus.setAttribute("data-theme", theme) 
  }

  // Register event handlers after documented loaded
  document.addEventListener("DOMContentLoaded", function() {
    var ref = document.querySelector("[data-md-component=palette]")
    ref.addEventListener("change", function() {
      var palette = __md_get("__palette")
      if (palette && typeof palette.color === "object") {
        var theme = palette.color.scheme === "slate"
          ? "transparent_dark"
          : "light"

        // Instruct Giscus to change theme
        var frame = document.querySelector(".giscus-frame")
        frame.contentWindow.postMessage(
          { giscus: { setConfig: { theme } } },
          "https://giscus.app"
        )
      }
    })
  })
</script>

</div>
                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../ch3/" class="md-footer__link md-footer__link--prev" aria-label="上一页: 3 Arithmetic for Computers">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                3 Arithmetic for Computers
              </div>
            </div>
          </a>
        
        
          
          <a href="../../lab/" class="md-footer__link md-footer__link--next" aria-label="下一页: 计算机组成 - 实验部分">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                计算机组成 - 实验部分
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/WintermelonC" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tabs.link", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.path", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="../../../../../assets/javascripts/katex.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/katex.min.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>